---
title: "Coding Principles Exercises"
lightbox: true
format:
  html:
    toc: true
  pdf:
    documentclass: article
---

```{r}
#| echo: false
#| warnings: false
#| message: false
library(EVR628tools)
library(tidyverse)
```

# Exercise 1: Object Classes and Assignment (10 minutes)

## Part A: Create and Check Object Classes

Create objects of different classes and check their types:

- Create a character object called `my_name` with your name
- Create a numeric object called `my_age` with your age
- Create a logical object called `is_student` with TRUE or FALSE
- Check the class of each object using `class()`

```{r}
# My code will be here

```

## Part B: Object Coercion

- Convert your age to character using `as.character()`
- Convert TRUE to numeric using `as.numeric()`
- Try to convert "hello" to numeric - what happens?
- Check the class of each result

```{r}
# My code will be here

```

# Exercise 2: Vectors and Operations (15 minutes)

## Part A: Create and Manipulate Vectors

- Create a numeric vector called `length_m` with values: 3.2, 4.1, 2.8, 5.5, 3.9 (in meters)
- Create a character vector called `shark_species` with: "Great White Shark", "Lemon Shark", "Bull Shark", "Hammerhead Shark", "Mako Shark"
- Find the length of both vectors using `length()`
- Calculate the mean length using `mean()`
- Find the maximum length using `max()`

```{r}
# My code will be here

```

::: {.callout-important}
- When passing arguments to functions, use `=` not `<-`
- When creating objects, use `<-` not `=`
:::


## Part B: Vector Operations and Indexing

- Convert the `length` from meters to feet (multiply by 3.281), save the output into `length_ft`
- Extract the first 3 shark species using indexing with `[]` and save them to an object called `first_3`
- Extract shark species where maximum length is greater than 4 meters
- Create a logical vector showing which sharks have max length above 4 meters

```{r}
# My code will be here

```

## Part C: Another carrot: `rfishbase`

- Install the package with: `install.packages("rfisbhase")`
- Use the `first_3` object to get the plausible scientific names of the sharks with `rfishbase::common_to_sci()`
- Save the results into an object called `shark_sci_names`

```{r}
# My code will be here

```

# Exercise 3: Data Frames and Tibbles (15 minutes)

## Part A: Estimate the effect of a Marine Protected Area on Biomass

Create four objects containing:

- The average biomass inside the MPA before it was protected
- The average biomass inside the MPA after it was protected
- The average biomass outside the MPA before the MPA was created
- The average biomass outside the MPA after the MPA was created

Then, calculate:

- Change after vs before for the protected site
- Change after vs before for the unprotected site

Finally:

- The difference between these two sites

This is called the *naive* difference-in-differences estimate. See @villasenor2018user and @lynham2024evidence for details.


```{r}
#| include: false
library(EVR628tools)
library(tidyverse)
data("data_MPA")

ggplot(data_MPA, aes(x = time, y = biomass, color = protected == 1)) + 
  geom_point() +
  geom_smooth()

ggplot(data_MPA, aes(x = after, y = biomass, color = protected == 1)) +
  stat_summary(geom = "pointrange", fun.data = "mean_se",
               position = position_dodge(width = 0.25))

## Manually calculate DiD ------------------------------------------------------
mean_protected_before <- mean(data_MPA$biomass[data_MPA$protected == 1 & data_MPA$after == 0])
mean_protected_after <- mean(data_MPA$biomass[data_MPA$protected == 1 & data_MPA$after == 1])
mean_control_before <- mean(data_MPA$biomass[data_MPA$protected == 0 & data_MPA$after == 0])
mean_control_after <- mean(data_MPA$biomass[data_MPA$protected == 0 & data_MPA$after == 1])

# Difference in time for each site
dif_protected <- mean_protected_after - mean_protected_before
dif_control <- mean_control_after - mean_control_before

# Differences across sites
dif_in_dif <- dif_protected - dif_control

dif_in_dif

lm(biomass ~ after + protected + after * protected,
      data = data_MPA) |> 
  summary()
```

```{r}
# My code will be here

```

# Exercise 4: Building Functions (15 minutes)

## Part A: Create Your Own Function

- Create a function called `did` that takes three vectors:
  - `after`
  - `treated`
  - and `outcome`
- Calculates a DiD estimate
- Test your function using the `data_MPA`

```{r}
# My code will be here

```

# Exercise 5: Pipes (10 minutes)

## Part A: Basic Pipes

```{r}
# My code will be here

```


# Exercise 6: Code Style and Documentation (10 minutes)

## Part A: Fix Code Style

Fix the style issues in this code:
```r
myfunction<-function(x,y){
result=x+y*2
return(result)
}
mydataframe=data.frame(species=c("Great White","Tiger"),length=c(4.5,3.2))
mean(mydataframe$length,na.rm=TRUE)
```

```{r}
# My improved code will be here

```

## Part B: Add Comments and Section Headers

Take your shark analysis from Exercise 5 and:
- Add section headers with `###`
- Add meaningful comments explaining what each step does
- Add a comment explaining WHY you're doing the analysis
- Make sure your code follows good naming conventions
